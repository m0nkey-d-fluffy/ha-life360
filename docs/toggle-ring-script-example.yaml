# Add this to your configuration.yaml or scripts.yaml

script:
  toggle_tile_ring:
    alias: "Toggle Tile Ring"
    description: "Ring or stop ringing a Tile device"
    fields:
      entity_id:
        description: "The Tile device tracker entity"
        example: "device_tracker.tile_1fd609ad"
        required: true
        selector:
          entity:
            integration: life360
            domain: device_tracker
      duration:
        description: "Ring duration in seconds"
        default: 30
        selector:
          number:
            min: 1
            max: 300
      strength:
        description: "Ring strength (1-3)"
        default: 2
        selector:
          number:
            min: 1
            max: 3
    sequence:
      - choose:
          # Check if the device is already ringing (stored in input_boolean)
          - conditions:
              - condition: template
                value_template: >
                  {% set device_id = entity_id.split('.')[1] %}
                  {{ is_state('input_boolean.tile_ringing_' ~ device_id, 'on') }}
            sequence:
              # Stop ringing
              - service: life360.stop_ring_device
                data:
                  entity_id: "{{ entity_id }}"
              # Mark as not ringing
              - service: input_boolean.turn_off
                data:
                  entity_id: "input_boolean.tile_ringing_{{ entity_id.split('.')[1] }}"
        default:
          # Start ringing
          - service: life360.ring_device
            data:
              entity_id: "{{ entity_id }}"
              duration: "{{ duration }}"
              strength: "{{ strength }}"
          # Mark as ringing
          - service: input_boolean.turn_on
            data:
              entity_id: "input_boolean.tile_ringing_{{ entity_id.split('.')[1] }}"
          # Auto-stop after duration
          - delay:
              seconds: "{{ duration }}"
          - service: input_boolean.turn_off
            data:
              entity_id: "input_boolean.tile_ringing_{{ entity_id.split('.')[1] }}"

# Create helpers to track ring state for each Tile
# Go to Settings → Devices & Services → Helpers → Create Helper → Toggle
# Name them: tile_ringing_tile_1fd609ad, tile_ringing_tile_9406d9fe, etc.
# OR add this to configuration.yaml:

input_boolean:
  tile_ringing_tile_1fd609ad:
    name: "Tile 1fd609ad Ringing"
    icon: mdi:bell-ring
  tile_ringing_tile_9406d9fe:
    name: "Tile 9406d9fe Ringing"
    icon: mdi:bell-ring
  tile_ringing_tile_00caf133:
    name: "Tile 00caf133 Ringing"
    icon: mdi:bell-ring
  tile_ringing_tile_9c37e810:
    name: "Tile 9c37e810 Ringing"
    icon: mdi:bell-ring
